<!-- encoding: UTF-8 -->
<% 
const courses = [
  { id: '1', title: 'JavaScript Fundamentals', category: 'Programming', description: 'Learn the basics of JavaScript programming', quizCount: 0, estimatedTime: '2 hours', difficulty: 'beginner' },
  { id: '2', title: 'React Advanced Patterns', category: 'Programming', description: 'Master advanced React concepts and patterns', quizCount: 0, estimatedTime: '4 hours', difficulty: 'advanced' },
  { id: '3', title: 'Data Structures & Algorithms', category: 'Computer Science', description: 'Essential DSA concepts for interviews', quizCount: 0, estimatedTime: '6 hours', difficulty: 'intermediate' },
  { id: '4', title: 'UI/UX Design Principles', category: 'Design', description: 'Learn fundamental design principles', quizCount: 0, estimatedTime: '3 hours', difficulty: 'beginner' }
];

const categories = ['All', 'Programming', 'Computer Science', 'Design'];
%>

<div class="space-y-6">
  <div class="space-y-4">
    <div class="relative">
      <i
        data-lucide="search"
        class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-5 h-5"
      ></i>
      <input
        id="course-search"
        placeholder="Search courses..."
        class="pl-10 w-full rounded-md border border-border input px-3 py-2 outline-none"
      />
    </div>
    <div class="flex gap-2 flex-wrap" id="category-filters">
      <% categories.forEach(function(cat){ %>
      <button
        type="button"
        data-category="<%= cat %>"
        class="rounded-full border border-border px-3 py-1 text-sm text-foreground"
      >
        <%= cat %>
      </button>
      <% }); %>
    </div>
  </div>

  <div
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    id="course-grid"
  >
    <% courses.forEach(function(c){ 
      const diffClass = ({
        beginner: 'bg-success/20 text-success border-success/30',
        intermediate: 'bg-warning/20 text-warning border-warning/30',
        advanced: 'bg-danger/20 text-danger border-danger/30'
      })[c.difficulty]; %>
    <div
      class="bg-gradient-card border border-border shadow-card rounded-xl p-0 cursor-pointer hover:shadow-glow transition"
      data-course
      data-dialog-open="course-dialog"
      data-title-full="<%= c.title %>"
      data-description="<%= c.description %>"
      data-category="<%= c.category %>"
      data-difficulty="<%= c.difficulty %>"
      data-time="<%= c.estimatedTime %>"
      data-title="<%= c.title.toLowerCase() %>"
      data-desc="<%= c.description.toLowerCase() %>"
    >
      <div class="px-6 pt-6">
        <div class="flex items-start justify-between gap-2 mb-2">
          <span
            class="inline-flex items-center px-2 py-0.5 text-xs rounded border border-border/50"
            ><%= c.category %></span
          >
          <span
            class="inline-flex items-center px-2 py-0.5 text-xs rounded border <%= diffClass %>"
            ><%= c.difficulty %></span
          >
        </div>
        <h4 class="text-xl text-foreground mb-2"><%= c.title %></h4>
      </div>
      <div class="px-6 pb-6 space-y-4">
        <p class="text-muted-foreground text-sm"><%= c.description %></p>
        <div class="flex items-center gap-4 text-sm text-muted-foreground">
          <div class="flex items-center gap-1">
            <i data-lucide="book-open" class="w-4 h-4"></i>
            <span><%= c.quizCount %> quizzes</span>
          </div>
          <div class="flex items-center gap-1">
            <i data-lucide="clock" class="w-4 h-4"></i>
            <span><%= c.estimatedTime %></span>
          </div>
        </div>
      </div>
    </div>
    <% }); %>
  </div>

  <!-- Course Detail Dialog -->
  <div
    id="course-dialog"
    data-dialog
    class="fixed inset-0 hidden items-center justify-center z-50"
  >
    <div class="absolute inset-0 bg-black/60" data-dialog-close></div>
    <div
      class="relative w-full max-w-xl mx-auto bg-card border border-border rounded-2xl shadow-card p-6"
    >
      <button
        class="absolute right-3 top-3 text-muted-foreground"
        data-dialog-close
      >
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
      <h3 id="dlg-title" class="text-xl font-bold text-foreground mb-1">
        Course Title
      </h3>
      <p id="dlg-desc" class="text-sm text-muted-foreground mb-4">
        Course description...
      </p>
      <div class="flex items-center gap-2 mb-3 text-sm">
        <span
          id="dlg-category"
          class="inline-flex items-center px-2 py-0.5 text-xs rounded border border-border/60"
        ></span>
        <span
          id="dlg-difficulty"
          class="inline-flex items-center px-2 py-0.5 text-xs rounded border border-border/60"
        ></span>
      </div>
      <div class="flex items-center gap-2 text-sm text-muted-foreground mb-4">
        <i data-lucide="clock" class="w-4 h-4"></i>
        <span id="dlg-time"></span>
      </div>
      <div
        class="rounded-lg border-2 dashed border-border bg-white/5 p-8 text-center space-y-2"
      >
        <i
          data-lucide="book-open"
          class="w-10 h-10 mx-auto text-muted-foreground"
        ></i>
        <p class="text-foreground font-semibold">No quizzes available yet</p>
        <p class="text-sm text-muted-foreground">
          Check back soon for new content!
        </p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const search = document.getElementById("course-search");
      const cards = Array.from(document.querySelectorAll("[data-course]"));
      const filters = document.getElementById("category-filters");
      let activeCategory = "All";
      function apply() {
        const q = (search.value || "").toLowerCase();
        cards.forEach((card) => {
          const inSearch =
            card.dataset.title.includes(q) || card.dataset.desc.includes(q);
          const inCat =
            activeCategory === "All" ||
            card.dataset.category === activeCategory;
          card.classList.toggle("hidden", !(inSearch && inCat));
        });
      }
      search.addEventListener("input", apply);
      filters.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-category]");
        if (!btn) return;
        activeCategory = btn.getAttribute("data-category");
        filters
          .querySelectorAll("button")
          .forEach((b) => b.classList.remove("bg-primary", "text-white"));
        btn.classList.add("bg-primary", "text-white");
        apply();
      });

      // Dialog population
      const dlg = document.getElementById("course-dialog");
      function openDlg(card) {
        document.getElementById("dlg-title").textContent =
          card.getAttribute("data-title-full") || "";
        document.getElementById("dlg-desc").textContent =
          card.getAttribute("data-description") || "";
        document.getElementById("dlg-category").textContent =
          card.getAttribute("data-category") || "";
        const diff = card.getAttribute("data-difficulty") || "";
        document.getElementById("dlg-difficulty").textContent =
          "Difficulty: " + diff;
        document.getElementById("dlg-time").textContent =
          "Estimated time: " + (card.getAttribute("data-time") || "");
        dlg.classList.remove("hidden");
        dlg.classList.add("flex");
        if (window.lucide && lucide.createIcons) lucide.createIcons();
      }
      document.getElementById("course-grid").addEventListener("click", (e) => {
        const card = e.target.closest("[data-course]");
        if (!card) return;
        openDlg(card);
      });
    })();
  </script>
</div>
